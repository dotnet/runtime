<Project>
  <Import Project="$(RepositoryEngineeringDir)testing\tests.mobile.targets" Condition="'$(RuntimeIdentifier)' == 'browser-wasm'" />

  <Target Name="RemoveRuntimePackFromDownloadItem"
          AfterTargets="ProcessFrameworkReferences">
    <ItemGroup>
      <PackageDownload Remove="@(PackageDownload)"
                       Condition="'$(UsePackageDownload)' == 'true' and $([System.String]::Copy('%(Identity)').StartsWith('Microsoft.NETCore.App.Runtime'))" />
      <PackageReference Remove="@(PackageReference)"
                        Condition="'$(UsePackageDownload)' != 'true' and $([System.String]::Copy('%(Identity)').StartsWith('Microsoft.NETCore.App.Runtime'))" />
    </ItemGroup>
  </Target>

  <Target Name="UpdateRuntimePack"
          AfterTargets="ResolveFrameworkReferences">
    <ItemGroup>
      <ResolvedRuntimePack Update="@(ResolvedRuntimePack)" PackageDirectory="$(RuntimePackDir)" />
      <ResolvedTargetingPack Update="@(ResolvedTargetingPack)" Path="$(TargetingPackDir)" />
    </ItemGroup>
  </Target>

  <Target Name="EnsureAllAssembliesAreLinked"
          BeforeTargets="PrepareForILLink"> 
    <ItemGroup>
      <ManagedAssemblyToLink>
        <TrimMode>link</TrimMode>
      </ManagedAssemblyToLink>

      <!-- Pass the app assembly as a root -->
      <TrimmerRootAssembly Include="@(IntermediateAssembly)" />
    </ItemGroup>
  </Target>

  <Target Name="RootJavaScriptInteropAssembly"
          BeforeTargets="PrepareForILLink"
          Condition="'$(RuntimeIdentifier)' == 'browser-wasm'">
    <ItemGroup>
      <TrimmerRootAssembly Include="%(ManagedAssemblyToLink.Identity)" Condition="'%(ManagedAssemblyToLink.FileName)' == 'System.Private.Runtime.InteropServices.JavaScript'" />
    </ItemGroup>
  </Target>

  <!-- Overriding this target as these projects won't need to binplace -->
  <Target Name="GetBinPlaceTargetFramework" />
  <Target Name="PublishTestAsSelfContained" />

  <PropertyGroup>
    <BundleDir>$([MSBuild]::NormalizeDirectory('$(MSBuildProjectDirectory)', '$(OutputPath)', 'AppBundle'))</BundleDir>
    <WasmMainAssemblyFileName>project.dll</WasmMainAssemblyFileName>
  </PropertyGroup>

</Project>

parameters:
  isOfficialBuild:
    type: boolean
    displayName: 'Is Official Build'
  scriptRoot:
    type: string
    displayName: 'Script Root'
    default: '$(Build.SourcesDirectory)'

steps:
- ${{ if and(eq(parameters.isOfficialBuild, true), ne(variables['Build.Reason'], 'PullRequest'), or(startswith(variables['Build.SourceBranch'], 'refs/heads/release/'), startswith(variables['Build.SourceBranch'], 'refs/heads/internal/release/'), startswith(variables['Build.SourceBranch'], 'refs/heads/reltest/')), not(endsWith(variables['Build.SourceBranch'], '-staging'))) }}:
  - powershell: |
      ${{ parameters.scriptRoot }}/eng/pipelines/remove-diagnostic-certs.ps1 "$(DacCertificateThumbprints)"
    displayName: 'Remove Diagnostic Certificates'
    condition: always()

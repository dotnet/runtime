parameters:
  # Please see /eng/performance/templates/runtime-perf-job.yml and /eng/performance/templates/run-performance-job.yml in the 
  # dotnet/performance repository for a full list of parameters that can be set. All parameters will be forwarded through.
  steps: [] # optional -- any additional steps that need to happen between cloning the performance repo and running the performance job

jobs:
- template: /eng/performance/templates/runtime-perf-job.yml@performance
  parameters:
    ${{ each parameter in parameters }}:
      ${{ if notIn(parameter.key, 'steps') }}:
        ${{ parameter.key }}: ${{ parameter.value }}
    performanceRepoDir: $(Build.SourcesDirectory)/performance
    runtimeRepoDir: $(Build.SourcesDirectory)
    steps:
      - ${{ if eq(parameters.osGroup, 'windows') }}:
        - template: /eng/pipelines/common/templates/disable-vsupdate-or-failfast.yml@self
      - checkout: self
        path: runtime
        clean: true
        fetchDepth: $(checkoutFetchDepth)
      - checkout: performance
        path: performance
        clean: true
        fetchDepth: $(checkoutFetchDepth)
      # Copy dotnet-runtime directory to Build.SourcesDirectory as many templates in this repository are dependent on it being there
      - task: CopyFiles@2
        inputs:
          SourceFolder: $(Build.SourcesDirectory)/runtime
          TargetFolder: $(Build.SourcesDirectory)
      # And remove the original
      - task: DeleteFiles@1
        inputs:
          SourceFolder: $(Build.SourcesDirectory)/runtime
      - ${{ each step in parameters.steps }}:
        - ${{ step }}
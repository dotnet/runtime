parameters:
  buildConfig: ''                 # required -- build configuration
  archType: ''                    # required -- targeting CPU architecture
  osGroup: ''                     # required -- operating system for the job
  osSubgroup: ''                  # optional -- operating system subgroup
  pool: ''
  stagedBuild: false
  timeoutInMinutes: ''
  framework: net5.0 # Specify the appropriate framework when running release branches (ie netcoreapp3.0 for release/3.0)
  variables: {}
  dependOnEvaluatePaths: false
  runJobTemplate: '/eng/pipelines/coreclr/templates/run-superpmi-replay-job.yml'

jobs:
- template: ${{ parameters.runJobTemplate }}
  parameters:
    jobName: ${{ format('superpmibuild_{0}{1}_{2}_{3}', parameters.osGroup, parameters.osSubgroup, parameters.archType, parameters.buildConfig) }}
    displayName: ${{ format('SuperPMI replay {0} {1}', parameters.osGroup, parameters.archType) }}
    pool: ${{ parameters.pool }}
    buildConfig: ${{ parameters.buildConfig }}
    archType: ${{ parameters.archType }}
    osGroup: ${{ parameters.osGroup }}
    osSubgroup: ${{ parameters.osSubgroup }}
    dependOnEvaluatePaths: ${{ parameters.dependOnEvaluatePaths }}
    additionalSetupParameters: ${{ parameters.additionalSetupParameters }}
    # dependsOn:
    #  - ${{ format('coreclr_jit_build_{0}{1}_{2}_{3}', parameters.osGroup, parameters.osSubgroup, parameters.archType, parameters.buildConfig) }}

    variables:
    - ${{ parameters.variables }}

    - name: ClrJitRootFolder
      value: '$(Build.SourcesDirectory)/artifacts/bin/coreclr/windows.$(archType).$(buildConfigUpper)'

    - name: ClrJitArtifactName
      value: 'CoreCLRProduct_${{ parameters.pgoType }}_${{ parameters.runtimeVariant }}_windows$(osSubgroup)_$(archType)_$(buildConfig)'

    frameworks:
      - ${{ parameters.framework }}

    steps:

    # Download jit builds
    - template: /eng/pipelines/common/download-specific-artifact-step.yml
      parameters:
        unpackFolder: '$(ClrJitRootFolder)'
        artifactFileName: '$(ClrJitArtifactName)$(archiveExtension)'
        artifactName: '$(ClrJitArtifactName)'
        displayName: 'JIT product build'
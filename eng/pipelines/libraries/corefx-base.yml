parameters:
  # Required: TargetOS value to know what script commands to use
  # Accepted values:
  # - Windows_NT
  # - Linux
  # - OSX
  # - FreeBSD
  targetOS: ''

  # Required: A collection of jobs to run - https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=vsts&tabs=schema#job
  jobs: []

  # Required: value to specify if the job is comming from an official build to run extra steps and sign binaries
  #   Default: false
  isOfficialBuild: false

  # EACH JOB SHOULD INCLUDE THE FOLLOWING PROPERTIES (ASIDE FROM THE REQUIRED ONES IN THE JOB SCHEMA)

  # Required: as part of the strategy matrix, the following variables should be defined
  #     _BuildConfig: Debug | Release
  #     _architecture: x64 | x86 | arm | arm64
  #     _framework: (netcoreapp, netfx).
  #     _helixQueues: Windows.Amd64 (Only needed if submitToHelix -> true.) -- Queues should be separated by + if multiple.

  # Required: empty | innerloop | outerloop | all
  testScope: ''

  # Optional: _publishTests -> Boolean -> Publish test assets to blob storage if true.
  # Default: false
  #     _publishTests: true | false

  # Required: submitToHelix -> Boolean -> Value to know if it should submit tests payloads to helix.

  # Optional: buildScriptPrefix -> String -> string to append to Unix build script.
  #   buildScriptPrefix: 'HOME=/home/ ' -> 'HOME=/home/ ./$(buildScriptName).sh ...'

  # Optional: buildExtraArguments -> String -> string to append at the end of the build arguments
  #   buildExtraArguments: /p:RuntimeOS=win10 -> '$(buildScriptName).cmd ... /p:RuntimeOS=win10'

  # Optional: customBuildSteps -> Array -> list of steps to run instead of the common build steps.
  #   customBuildSteps:
  #     - script: echo Hello World
  #       displayName: MyScript

  # Optional: preBuildSteps -> Array -> list of steps to be executed before common build steps.
  # In example, to install build dependencies, or setup an environment.
  #   preBuildSteps:
  #     - script: brew install cmake
  #       displayName: Install Cmake

  # timeoutInMinutes: if a job doesn't define it, we will default it to 150 minutes

  coreClrArtifactName: ''
  coreFxArtifactName: ''
  variables: ''

jobs:
  - ${{ each job in parameters.jobs }}:
    - template: /eng/pipelines/libraries/corefx-steps.yml
      parameters:
        targetOS: ${{ parameters.targetOS }}
        isOfficialBuild: ${{ parameters.isOfficialBuild }}
        testScope: ${{ parameters.testScope }}
        coreClrArtifactName: ${{ parameters.coreClrArtifactName }}
        coreFxArtifactName: ${{ parameters.coreFxArtifactName }}
        variables: ${{ job.variables }}
        submitToHelix: ${{ job.submitToHelix }}
        frameworkArg: ${{ job.frameworkArg }}
        buildExtraArguments: ${{ job.buildExtraArguments }}
        buildScriptPrefix: ${{ job.buildScriptPrefix }}
        preBuildSteps: ${{ job.preBuildSteps }}
        customBuildSteps: ${{ job.customBuildSteps }}
        job: ${{ job.job }}
        timeoutInMinutes: ${{ job.timeoutInMinutes }}

        # pass along job properties
        ${{ each property in job }}:
          ${{ if and(ne(property.key, 'job'), ne(property.key, 'variables')) }}:
            ${{ property.key }}: ${{ property.value }}

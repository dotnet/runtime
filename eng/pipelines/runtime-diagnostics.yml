trigger: none

resources:
  repositories:
    - repository: diagnostics
      type: github
      name: dotnet/diagnostics
      endpoint: public

variables:
  - template: /eng/pipelines/common/variables.yml
  - name: diagJobTemplate
    value: /eng/common/templates/job/job.yml

schedules:
- cron: "30 2 * * *"
  displayName: Every night at 2:30AM
  branches:
    include:
    - main
  always: true

extends:
  template:  /eng/pipelines/common/templates/pipeline-with-resources.yml
  parameters:
    stages:
    - stage: Build
      jobs:
      - template: /eng/pipelines/common/platform-matrix.yml
        parameters:
          jobTemplate: /eng/pipelines/common/global-build-job.yml
          buildConfig: release
          platforms:
          - windows_x64
          jobParameters:
            buildArgs: -s clr+libs+host+packs -c $(_BuildConfig)
            nameSuffix: AllSubsets_CoreCLR
            isOfficialBuild: ${{ variables.isOfficialBuild }}
            timeoutInMinutes: 360
      - template: /eng/pipelines/build.yml@diagnostics
        parameters:
          jobTemplate: ${{ variables.diagJobTemplate }}
          name: Windows
          osGroup: Windows_NT
          buildConfigs:
          - configuration: Debug
            architecture: x64
          - configuration: Release
            architecture: x64
            artifactUploadPath: bin
          - configuration: Release
            architecture: x86
            artifactUploadPath: bin/Windows_NT.x86.Release
          - ${{ if ne(variables['System.TeamProject'], 'public') }}:
            - configuration: Release
              architecture: arm64
              artifactUploadPath: bin/Windows_NT.arm64.Release
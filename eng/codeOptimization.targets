<Project>

  <PropertyGroup Condition="'$(IsEligibleForNgenOptimization)' == ''">
     <IsEligibleForNgenOptimization>true</IsEligibleForNgenOptimization>
     <IsEligibleForNgenOptimization Condition="'$(IsReferenceAssembly)' == 'true'">false</IsEligibleForNgenOptimization>
     <IsEligibleForNgenOptimization Condition="'$(GeneratePlatformNotSupportedAssembly)' == 'true' or '$(GeneratePlatformNotSupportedAssemblyMessage)' != ''">false</IsEligibleForNgenOptimization>
  </PropertyGroup>

  <Target Name="SetApplyNgenOptimization"
          Condition="'$(IsEligibleForNgenOptimization)' == 'true'"
          BeforeTargets="CoreCompile">
    <PropertyGroup>
      <IbcOptimizationDataDir Condition="'$(BuildOS)' == 'Unix' or '$(BuildOS)' == 'Linux'">$(IbcOptimizationDataDir)Linux\</IbcOptimizationDataDir>
      <IbcOptimizationDataDir Condition="'$(BuildOS)' != 'Unix' and '$(BuildOS)' != 'Linux'">$(IbcOptimizationDataDir)Windows\</IbcOptimizationDataDir>
    </PropertyGroup>
    <ItemGroup>
      <_optimizationDataAssembly Include="$(IbcOptimizationDataDir)**\$(TargetFileName)" />
    </ItemGroup>
    <PropertyGroup>
      <ApplyNgenOptimization Condition="'@(_optimizationDataAssembly)' != ''">full</ApplyNgenOptimization>
    </PropertyGroup>
  </Target>

</Project>

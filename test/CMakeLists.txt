cmake_minimum_required(VERSION 3.14.5)

project(SvenProj)
# print out CHECK_INCLUDE_FILE_C_INCLUDE_DIRS:
message(STATUS "SVEN: CHECK_INCLUDE_FILE_C_INCLUDE_DIRS: ${CHECK_INCLUDE_FILE_C_INCLUDE_DIRS}")
# print out CMAKE_REQUIRED_INCLUDES
message(STATUS "SVEN: CMAKE_REQUIRED_INCLUDES: ${CMAKE_REQUIRED_INCLUDES}")

include(CheckIncludeFile)
include(CheckCCompilerFlag)

# Print all env vars by runnin env command:
#execute_process(COMMAND env
#                OUTPUT_VARIABLE ENVIRONMENT_VARIABLES)
#message(STATUS "SVEN: ENVIRONMENT_VARIABLES: ${ENVIRONMENT_VARIABLES}")
#message(STATUS "SVEN: CC: $ENV{CC}")
#message(STATUS "SVEN: CCC_CC: $ENV{CCC_CC}")
message("SVEN: CMAKE_C_IMPLICIT_INCLUDE_DIRECTORIES: ${CMAKE_C_IMPLICIT_INCLUDE_DIRECTORIES}")
message("SVEN: CMAKE_C_STANDARD_INCLUDE_DIRECTORIES: ${CMAKE_C_STANDARD_INCLUDE_DIRECTORIES}")
message("SVEN: CMAKE_INCLUDE_PATH: ${CMAKE_INCLUDE_PATH}")
message("SVEN: CMAKE_SYSTEM_INCLUDE_PATH: ${CMAKE_SYSTEM_INCLUDE_PATH}")
message("SVEN: CMAKE_REQUIRED_QUIET: ${CMAKE_REQUIRED_QUIET}")
message("SVEN: CMAKE_FILES_DIRECTORY: ${CMAKE_FILES_DIRECTORY}")
message("SVEN: ${CMAKE_ROOT}")
# Show contents of ${CMAKE_ROOT}/Modules/CheckIncludeFile.c.in
file(READ ${CMAKE_ROOT}/Modules/CheckIncludeFile.c.in _CIF_SOURCE_CONTENT)
message("SVEN: ${_CIF_SOURCE_CONTENT}")

set(CHECK_INCLUDE_FILE_VAR "/usr/include/malloc.h")
    configure_file(${CMAKE_ROOT}/Modules/CheckIncludeFile.c.in
      ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/CheckIncludeFile.c)
    try_compile(SVEN_MALLOC_FOUND
      ${CMAKE_BINARY_DIR}
      ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/CheckIncludeFile.c
      COMPILE_DEFINITIONS ${CMAKE_REQUIRED_DEFINITIONS}
      ${_CIF_LINK_OPTIONS}
      ${_CIF_LINK_LIBRARIES}
      CMAKE_FLAGS
      -DCOMPILE_DEFINITIONS:STRING=${MACRO_CHECK_INCLUDE_FILE_FLAGS}
      "${CHECK_INCLUDE_FILE_C_INCLUDE_DIRS}"
      OUTPUT_VARIABLE OUTPUT)

message("SVEN: OUTPUT: ${OUTPUT}")

#file(READ ${CMAKE_ROOT}/Modules/CheckIncludeFile.c.in _CIF_SOURCE_CONTENT)
#try_compile(SVEN_MALLOC_FOUND
#  SOURCE_FROM_VAR CheckIncludeFile.c _CIF_SOURCE_CONTENT
#  COMPILE_DEFINITIONS ${CMAKE_REQUIRED_DEFINITIONS}
#  ${_CIF_LINK_OPTIONS}
#  ${_CIF_LINK_LIBRARIES}
#  CMAKE_FLAGS
#  -DCOMPILE_DEFINITIONS:STRING=${MACRO_CHECK_INCLUDE_FILE_FLAGS}
#  "${CHECK_INCLUDE_FILE_C_INCLUDE_DIRS}"
#  )
message("SVEN: SVEN_MALLOC_FOUND: ${SVEN_MALLOC_FOUND}")



check_include_file ("/usr/include/malloc.h" FOUND_MALLOC)
message(STATUS "SVEN: MALLOC? ${FOUND_MALLOC}")
return()

<Project>
  <!-- This depends on the root Directory.Build.props imported this file -->
  <PropertyGroup>
    <UsingMicrosoftNETSdkWebAssembly>true</UsingMicrosoftNETSdkWebAssembly>
    <UsingBrowserRuntimeWorkload>true</UsingBrowserRuntimeWorkload>
    <UsingBlazorAOTWorkloadManifest>true</UsingBlazorAOTWorkloadManifest>

    <WasmCommonTargetsPath Condition="Exists('$(MSBuildThisFileDirectory)WasmApp.Common.props')">$(MSBuildThisFileDirectory)</WasmCommonTargetsPath>
    <WasmCommonTargetsPath Condition="'$(WasmCommonTargetsPath)' == ''">$([MSBuild]::NormalizeDirectory($(MonoProjectRoot), 'wasm', 'build'))</WasmCommonTargetsPath>

    <_WebAssemblyPropsFile Condition="'$(_WebAssemblyPropsFile)' == ''">$(MonoProjectRoot)\nuget\Microsoft.NET.Sdk.WebAssembly.Pack\build\Microsoft.NET.Sdk.WebAssembly.Browser.props</_WebAssemblyPropsFile>
    <_WebAssemblyTargetsFile Condition="'$(_WebAssemblyTargetsFile)' == ''">$(MonoProjectRoot)\nuget\Microsoft.NET.Sdk.WebAssembly.Pack\build\Microsoft.NET.Sdk.WebAssembly.Browser.targets</_WebAssemblyTargetsFile>
    <_WebAssemblySdkToolsDirectory Condition="'$(_WebAssemblySdkToolsDirectory)' == ''">$(ArtifactsBinDir)\Microsoft.NET.Sdk.WebAssembly.Pack.Tasks\$(RuntimeConfiguration)\</_WebAssemblySdkToolsDirectory>
  </PropertyGroup>

  <Import Sdk="Microsoft.NET.Sdk.WebAssembly" Project="Sdk.props" Condition="'$(UsingNativeAOT)' != 'true' and '$(UsingMicrosoftNETSdkWebAssembly)' == 'true'" />
  <Import Project="$(MSBuildThisFileDirectory)BrowserWasmApp.props" Condition="'$(UsingNativeAOT)' != 'true'" />

  <PropertyGroup Condition="'$(IsTestProject)' == 'true'">
    <OutputType>library</OutputType>
  </PropertyGroup>

  <PropertyGroup Condition="'$(_WasmInTreeDefaults)' != 'false'">
    <SelfContained>true</SelfContained>
    <Platform>AnyCPU</Platform>
    <EnableTargetingPackDownload>false</EnableTargetingPackDownload>
    <TargetFramework>$(NetCoreAppCurrent)</TargetFramework>
    <EMSDK_PATH Condition="'$(EMSDK_PATH)' == '' and '$(MonoProjectRoot)' != ''">$([MSBuild]::NormalizeDirectory($(MonoProjectRoot), 'browser', 'emsdk'))</EMSDK_PATH>
    <RunAOTCompilation Condition="'$(RunAOTCompilation)' == ''">false</RunAOTCompilation>
    <PublishTrimmed>true</PublishTrimmed>
    <RunAnalyzers>false</RunAnalyzers>

    <DisableImplicitFrameworkReferences>false</DisableImplicitFrameworkReferences>
    <UseLocalTargetingRuntimePack Condition="'$(UseLocalTargetingRuntimePack)' == ''">true</UseLocalTargetingRuntimePack>
    <!-- Tests don't yet use a live build of the apphost: https://github.com/dotnet/runtime/issues/58109. -->
    <UseLocalAppHostPack Condition="'$(UseLocalAppHostPack)' == ''">false</UseLocalAppHostPack>
    <EnableTargetingPackDownload>false</EnableTargetingPackDownload>
    <GenerateErrorForMissingTargetingPacks>false</GenerateErrorForMissingTargetingPacks>
    <ImportTargetingPacksTargetsInWasmAppTargets>true</ImportTargetingPacksTargetsInWasmAppTargets>
  </PropertyGroup>

  <!-- This is temporary hack for https://github.com/dotnet/runtime/issues/61294 -->
  <ItemGroup>
    <_MonoRuntimeComponentDontLink Include="libmono-component-debugger-stub-static.a" />
    <_MonoRuntimeComponentDontLink Include="libmono-component-hot_reload-stub-static.a" />
    <_MonoRuntimeComponentDontLink Include="libmono-component-marshal-ilgen-stub-static.a" />
  </ItemGroup>
</Project>

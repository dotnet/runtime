<Project>
  <!-- Tracking issue: https://github.com/dotnet/runtime/issues/119006
       Override the ResolveReadyToRunCompilers target to use the in-build crossgen2.
       This needs to be imported after SDK targets, so any project requiring this should set AfterMicrosoftNETSdkTargets -->
  <Target Name="ResolveReadyToRunCompilers" Condition="'$(PublishReadyToRun)' == true" DependsOnTargets="ResolveRuntimeFilesFromLocalBuild;ResolveLibrariesRuntimeFilesFromLocalBuild">
    <PropertyGroup>
      <Crossgen2Path>$([MSBuild]::NormalizePath('$(Crossgen2InBuildDir)', 'crossgen2$(ExeSuffix)'))</Crossgen2Path>
    </PropertyGroup>

    <ItemGroup>
      <Crossgen2Tool Include="$(Crossgen2Path)"
                     TargetArch="$(TargetArchitecture)"
                     TargetOS="$(TargetOS)"
                     PerfmapFormatVersion="$(PublishReadyToRunPerfmapFormatVersion)"/>
    </ItemGroup>

    <!-- Crossgen2 requires references to all runtime pack assemblies including System.Private.CoreLib.
         Add managed assemblies from the local runtime pack as references for Crossgen2. -->
    <ItemGroup>
      <_ReadyToRunImplementationAssemblies Include="@(RuntimeFiles)" Condition="'%(RuntimeFiles.Extension)' == '.dll'" ReferenceOnly="true" />
      <_ReadyToRunImplementationAssemblies Include="@(LibrariesRuntimeFiles)" Condition="'%(LibrariesRuntimeFiles.Extension)' == '.dll'" ReferenceOnly="true" />
    </ItemGroup>
  </Target>
</Project>

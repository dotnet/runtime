<Project>
  <PropertyGroup Condition="'$(Scenario)' == 'WasmDebuggerTests'">
    <NeedsToRunOnBrowser>true</NeedsToRunOnBrowser>
    <WorkItemPrefix>$(DebuggerHost)-</WorkItemPrefix>
    <UseDotNetCliVersionFromGlobalJson>true</UseDotNetCliVersionFromGlobalJson>
    <_DebuggerTestsWorkItemTimeout Condition="'$(Scenario)' == 'WasmDebuggerTests'">00:50:00</_DebuggerTestsWorkItemTimeout>
    <_DebuggerTestsWorkItemTimeout Condition="'$(Scenario)' == 'WasmDebuggerTests' and '$(BrowserHost)' == 'windows'">00:50:00</_DebuggerTestsWorkItemTimeout>

    <HelixExtensionTargets>$(HelixExtensionTargets);_AddWorkItemsForWasmDebuggerTests</HelixExtensionTargets>
  </PropertyGroup>

  <Target Name="_AddWorkItemsForWasmDebuggerTests">
    <!-- remove the existing item -->
    <HelixWorkItem Remove="@(HelixWorkItem)" Condition="'%(HelixWorkItem.Identity)' == 'Wasm.Debugger.Tests'" />

    <!--<ReadLinesFromFile File="$(TestArchiveTestsDir)DebuggerTestSuite.tests.list">-->
      <!--<Output TaskParameter="Lines" ItemName="_DebuggerTestsClassName" />-->
    <!--</ReadLinesFromFile>-->
    <PropertyGroup>
        <TestName>DebuggerTests.GetPropertiesTests</TestName>
    </PropertyGroup>
    <ItemGroup>
        <Idx Include="0;1;2;3;4;5;6;7;8;9" />
        <Idx Include="10;11;12;13;14;15;16;17;18;19" />
        <Idx Include="20;21;22;23;24;25;26;27;28;29" />
        <Idx Include="30;31;32;33;34;35;36;37;38;39" />
    </ItemGroup>

    <ItemGroup>
      <!--<HelixWorkItem Include="@(_DebuggerTestsClassName -> '$(DebuggerHost)-%(Identity)')">-->
      <HelixWorkItem Include="@(Idx -> '$(DebuggerHost)-$(TestName)-%(Identity)')">
        <PayloadArchive>$(TestArchiveTestsDir)Wasm.Debugger.Tests.zip</PayloadArchive>
        <Command>$(HelixCommand)</Command>
        <Timeout>$(_DebuggerTestsWorkItemTimeout)</Timeout>
        <PreCommands Condition="'$(OS)' == 'Windows_NT'">set &quot;TEST_ARGS=--filter category^^!=failing^&amp;FullyQualifiedName~$(TestName)&quot;</PreCommands>
        <PreCommands Condition="'$(OS)' != 'Windows_NT'">export &quot;TEST_ARGS=--filter category!=failing&amp;FullyQualifiedName~$(TestName)&quot;</PreCommands>
        <PostCommands Condition="'$(OS)' != 'Windows_NT'">dmesg;gzip %24XHARNESS_OUT/proxy*</PostCommands>
      </HelixWorkItem>
    </ItemGroup>
  </Target>
</Project>

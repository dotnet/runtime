<Project Sdk="Microsoft.NET.Sdk" DefaultTargets="Publish;PublishItemsOutputGroup">
  <!-- This project is specifically to build and publish a build of crossgen2 for shipping. -->
  <PropertyGroup>
    <_IsPublishing>true</_IsPublishing>
  </PropertyGroup>

  <PropertyGroup>
    <PublishTrimmed>true</PublishTrimmed>
    <RuntimeIdentifier>$(PackageRID)</RuntimeIdentifier>
    <SelfContained>true</SelfContained>
    <!-- Publish uses the LKG compiler, which is the tool compiler. -->
    <TargetFramework>$(NetCoreAppToolCurrent)</TargetFramework>
    <UseLocalAppHostPack>true</UseLocalAppHostPack>
    <TrimmerSingleWarn>false</TrimmerSingleWarn>
  </PropertyGroup>

  <PropertyGroup Condition="'$(UseNativeAotForComponents)' != 'true'">
    <PublishSingleFile>true</PublishSingleFile>
    <PublishReadyToRun>true</PublishReadyToRun>
    <!-- Disable crossgen on NetBSD, illumos, Solaris, and Haiku for now. This can be revisited when we have full support. -->
    <PublishReadyToRun Condition="'$(TargetOS)' == 'netbsd' Or '$(TargetOS)' == 'illumos' Or '$(TargetOS)' == 'solaris' Or '$(TargetOS)' == 'haiku'">false</PublishReadyToRun>
    <!-- Disable crossgen on FreeBSD when cross building from Linux. -->
    <PublishReadyToRun Condition="'$(TargetOS)' == 'freebsd' and '$(CrossBuild)' == 'true'">false</PublishReadyToRun>
    <PublishReadyToRunComposite>$(PublishReadyToRun)</PublishReadyToRunComposite>
  </PropertyGroup>

  <PropertyGroup Condition="'$(UseNativeAotForComponents)' == 'true'">
    <PublishAot>true</PublishAot>
    <!-- Use .dwarf files instead of .dsym files since our symbol exporting may not safely handle folders. -->
    <NativeSymbolExt Condition="'$(_IsApplePlatform)' == 'true'">.dwarf</NativeSymbolExt>
    <DsymUtilOptions Condition="'$(_IsApplePlatform)' == 'true'">--flat</DsymUtilOptions>
  </PropertyGroup>
  <Import Project="crossgen2.props" />

</Project>

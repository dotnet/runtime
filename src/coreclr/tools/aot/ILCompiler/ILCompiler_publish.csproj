<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <_IsPublishing>true</_IsPublishing>
    <RuntimeIdentifier>$(PackageRID)</RuntimeIdentifier>
    <PublishDir>$(RuntimeBinDir)ilc-published/</PublishDir>
    <PublishTrimmed>true</PublishTrimmed>
  </PropertyGroup>

  <Import Project="ILCompiler.props" />

  <PropertyGroup Condition="'$(UseNativeAotForComponents)' != 'true'">
    <PublishSingleFile>true</PublishSingleFile>
    <PublishReadyToRun>true</PublishReadyToRun>
    <!-- Disable crossgen on NetBSD, illumos, Solaris, and Haiku for now. This can be revisited when we have full support. -->
    <PublishReadyToRun Condition="'$(TargetOS)' == 'netbsd' Or '$(TargetOS)' == 'illumos' Or '$(TargetOS)' == 'solaris' Or '$(TargetOS)' == 'haiku'">false</PublishReadyToRun>
    <!-- Disable crossgen on FreeBSD when cross building from Linux. -->
    <PublishReadyToRun Condition="'$(TargetOS)' == 'freebsd' and '$(CrossBuild)' == 'true'">false</PublishReadyToRun>
    <PublishReadyToRunComposite>$(PublishReadyToRun)</PublishReadyToRunComposite>
  </PropertyGroup>

  <PropertyGroup Condition="'$(UseNativeAotForComponents)' == 'true'">
    <PublishAot>true</PublishAot>
    <!-- Use .dwarf files instead of .dsym files since our symbol exporting may not safely handle folders. -->
    <NativeSymbolExt Condition="'$(_IsApplePlatform)' == 'true'">.dwarf</NativeSymbolExt>
    <DsymUtilOptions Condition="'$(_IsApplePlatform)' == 'true'">--flat</DsymUtilOptions>
  </PropertyGroup>

  <Target Name="PublishAfterBuild"
          AfterTargets="Build"
          DependsOnTargets="Publish" />

</Project>

<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <PlatformTarget>AnyCPU</PlatformTarget>
    <TargetFramework>$(NetCoreAppToolCurrent)</TargetFramework>
    <GenerateRuntimeConfigurationFiles>true</GenerateRuntimeConfigurationFiles>
    <IsPackable>true</IsPackable>
    <PackAsTool>true</PackAsTool>
    <PackageDescription>The .NET IL Assembler.</PackageDescription>
    <PackageId>Microsoft.NETCore.ILAsm</PackageId>
    <ToolCommandName>ilasm</ToolCommandName>
  </PropertyGroup>

  <!-- Include native ilasm binaries for different platforms -->
  <!-- These will be populated by the official build for all target platforms -->
  <!-- During local development, build ilasm with 'build.sh clr' before packing this tool -->
  <ItemGroup>
    <!-- Linux -->
    <Content Include="$(ArtifactsBinDir)coreclr/linux.x64.$(CoreCLRConfiguration)/ilasm" Condition="Exists('$(ArtifactsBinDir)coreclr/linux.x64.$(CoreCLRConfiguration)/ilasm')">
      <PackagePath>runtimes/linux-x64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/linux-x64/native/ilasm</Link>
    </Content>
    <Content Include="$(ArtifactsBinDir)coreclr/linux.arm64.$(CoreCLRConfiguration)/ilasm" Condition="Exists('$(ArtifactsBinDir)coreclr/linux.arm64.$(CoreCLRConfiguration)/ilasm')">
      <PackagePath>runtimes/linux-arm64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/linux-arm64/native/ilasm</Link>
    </Content>
    <Content Include="$(ArtifactsBinDir)coreclr/linux.arm.$(CoreCLRConfiguration)/ilasm" Condition="Exists('$(ArtifactsBinDir)coreclr/linux.arm.$(CoreCLRConfiguration)/ilasm')">
      <PackagePath>runtimes/linux-arm/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/linux-arm/native/ilasm</Link>
    </Content>
    <Content Include="$(ArtifactsBinDir)coreclr/linux.musl.x64.$(CoreCLRConfiguration)/ilasm" Condition="Exists('$(ArtifactsBinDir)coreclr/linux.musl.x64.$(CoreCLRConfiguration)/ilasm')">
      <PackagePath>runtimes/linux-musl-x64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/linux-musl-x64/native/ilasm</Link>
    </Content>
    <Content Include="$(ArtifactsBinDir)coreclr/linux.musl.arm64.$(CoreCLRConfiguration)/ilasm" Condition="Exists('$(ArtifactsBinDir)coreclr/linux.musl.arm64.$(CoreCLRConfiguration)/ilasm')">
      <PackagePath>runtimes/linux-musl-arm64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/linux-musl-arm64/native/ilasm</Link>
    </Content>
    <!-- macOS -->
    <Content Include="$(ArtifactsBinDir)coreclr/osx.x64.$(CoreCLRConfiguration)/ilasm" Condition="Exists('$(ArtifactsBinDir)coreclr/osx.x64.$(CoreCLRConfiguration)/ilasm')">
      <PackagePath>runtimes/osx-x64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/osx-x64/native/ilasm</Link>
    </Content>
    <Content Include="$(ArtifactsBinDir)coreclr/osx.arm64.$(CoreCLRConfiguration)/ilasm" Condition="Exists('$(ArtifactsBinDir)coreclr/osx.arm64.$(CoreCLRConfiguration)/ilasm')">
      <PackagePath>runtimes/osx-arm64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/osx-arm64/native/ilasm</Link>
    </Content>
    <!-- Windows -->
    <Content Include="$(ArtifactsBinDir)coreclr/windows.x64.$(CoreCLRConfiguration)/ilasm.exe" Condition="Exists('$(ArtifactsBinDir)coreclr/windows.x64.$(CoreCLRConfiguration)/ilasm.exe')">
      <PackagePath>runtimes/win-x64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/win-x64/native/ilasm.exe</Link>
    </Content>
    <Content Include="$(ArtifactsBinDir)coreclr/windows.x86.$(CoreCLRConfiguration)/ilasm.exe" Condition="Exists('$(ArtifactsBinDir)coreclr/windows.x86.$(CoreCLRConfiguration)/ilasm.exe')">
      <PackagePath>runtimes/win-x86/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/win-x86/native/ilasm.exe</Link>
    </Content>
    <Content Include="$(ArtifactsBinDir)coreclr/windows.arm64.$(CoreCLRConfiguration)/ilasm.exe" Condition="Exists('$(ArtifactsBinDir)coreclr/windows.arm64.$(CoreCLRConfiguration)/ilasm.exe')">
      <PackagePath>runtimes/win-arm64/native/</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>runtimes/win-arm64/native/ilasm.exe</Link>
    </Content>
  </ItemGroup>

</Project>

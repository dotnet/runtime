<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>$(NetCoreAppToolCurrent)</TargetFrameworks>
    <SkipTestUtilitiesReference>true</SkipTestUtilitiesReference>
    <IsTestProject>true</IsTestProject>
    <BundleXunitRunner>true</BundleXunitRunner>
    <CLRTestKind>BuildAndRun</CLRTestKind>
    <TestFramework>xunit</TestFramework>
    <WasmGenerateAppBundle>false</WasmGenerateAppBundle>

    <!-- don't run any wasm build steps -->
    <WasmBuildAppAfterThisTarget />
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="WasmBuildAppTest.cs" />

    <None Include="$(RepoRoot)\src\mono\wasm\runtime-test.js" CopyToOutputDirectory="PreserveNewest" />
  </ItemGroup>

  <Target Name="SetRunScript" BeforeTargets="GenerateRunScript">
    <PropertyGroup>
      <BundleDir>$(OutDir)</BundleDir>
      <RunScriptOutputPath>$(OutDir)\RunTests.sh</RunScriptOutputPath>
      <RunScriptCommand Condition="'$(ContinuousIntegrationBuild)' == 'true'">find . ; find %24HELIX_CORRELATION_PAYLOAD -type d; set; WasmBuildSupportDir=%24{HELIX_CORRELATION_PAYLOAD}/build HARNESS_RUNNER=%24HARNESS_RUNNER TEST_LOG_PATH=%24XHARNESS_OUT/logs DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=1 dotnet exec xunit.console.dll $(AssemblyName).dll -xml %24XHARNESS_OUT/testResults.xml -nocolor</RunScriptCommand>
      <RunScriptCommand Condition="'$(ContinuousIntegrationBuild)' != 'true'">HARNESS_RUNNER=%24HARNESS_RUNNER TEST_LOG_PATH=%24XHARNESS_OUT/logs dotnet exec xunit.console.dll $(AssemblyName).dll -xml %24XHARNESS_OUT/testResults.xml</RunScriptCommand>
    </PropertyGroup>
  </Target>
</Project>

<!-- This project requires an explicit SDK version number because it is used on Helix,
      and global.json is not available. -->
<Project Sdk="Microsoft.Build.NoTargets/1.0.53" DefaultTargets="WasmBuildApp">
  <PropertyGroup>
    <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
    <MicrosoftNetCoreAppRuntimePackRidDir>$(CORE_ROOT)\runtimepack</MicrosoftNetCoreAppRuntimePackRidDir>
    <TargetFramework>$(NetCoreAppCurrent)</TargetFramework>
    <BuildDir>$(MSBuildThisFileDirectory)\obj\$(Configuration)\wasm</BuildDir>
    <AppDir>$(TestBinDir)/WasmApp/</AppDir>
    <NETCoreAppMaximumVersion>99.0</NETCoreAppMaximumVersion>
  </PropertyGroup>

  <Target Name="BuildApp" BeforeTargets="WasmBuildApp">
    <PropertyGroup>
      <WasmMainAssemblyPath Include="$(TestAssembly)" />
      <WasmAppDir>$(AppDir)</WasmAppDir>
      <WasmMainJSPath>$(CORE_ROOT)\runtime-test\runtime-test.js</WasmMainJSPath>
      <WasmResolveAssembliesBeforeBuild>true</WasmResolveAssembliesBeforeBuild>
      <WasmRunV8ScriptPath>$(WasmAppDir)/run-v8.sh</WasmRunV8ScriptPath>
    </PropertyGroup>

    <ItemGroup>
      <WasmAssembliesToBundle Include="$(CORE_ROOT)\System.Private.Runtime.InteropServices.JavaScript.dll" />
      <WasmAssemblySearchPaths Include="$(MicrosoftNetCoreAppRuntimePackDir)\native"/>
      <WasmAssemblySearchPaths Include="$(MicrosoftNetCoreAppRuntimePackDir)"/>
      <WasmAssemblySearchPaths Include="$(CORE_ROOT)/TargetingPack" />
      <WasmAssemblySearchPaths Include="$(TestBinDir)" />
    </ItemGroup>

    <Message Importance="High" Text="AppDir: $(AppDir)" />
    <Message Importance="High" Text="TestBinDir: $(TestBinDir)" />
    <Message Importance="High" Text="ArtifactsBinDir: $(ArtifactsBinDir)" />
  </Target>

  <Import Project="$(MonoProjectRoot)\wasm\build\WasmApp.targets" />
</Project>

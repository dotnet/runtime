<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="../../../Directory.Build.props" />

  <!-- This file contains common build properties for projects under
       the test tree, and also generated test projects in
       artifacts/tests. It currently has only those properties that are
       shared between old-style test projects and SDK-style test
       projects. Eventually every test project should build using the
       SDK. Some test projects still bypass this by importing
       tests/dir.props directly - these should eventually go away. -->

  <PropertyGroup>
    <OSPlatformConfig>$(TargetOS).$(TargetArchitecture).$(Configuration)</OSPlatformConfig>

    <BinDir>$(ArtifactsDir)bin\coreclr\$(OSPlatformConfig)\</BinDir>

    <BaseOutputPath>$(ArtifactsDir)tests\coreclr</BaseOutputPath>
    <BaseOutputPath Condition="'$(__TestRootDir)' != ''">$(__TestRootDir)</BaseOutputPath>
    <BaseOutputPathWithConfig>$([MSBuild]::NormalizePath('$(BaseOutputPath)\$(OSPlatformConfig)\'))</BaseOutputPathWithConfig>

    <TestWorkingDir>$(BaseOutputPathWithConfig)\</TestWorkingDir>

    <TestSourceDir>$([MSBuild]::NormalizePath('$(RepoRoot)/src/tests/'))</TestSourceDir>
    <TestSourceDir Condition="$([System.String]::new('$(MSBuildProjectDirectory)').StartsWith('$(BaseOutputPathWithConfig)'))">$(BaseOutputPathWithConfig)</TestSourceDir>
    <BuildProjectRelativeDir>$([MSBuild]::MakeRelative($(TestSourceDir), $(MSBuildProjectDirectory)))\$(MSBuildProjectName)\</BuildProjectRelativeDir>

    <!-- BaseIntermediateOutputPath is used by the SDK as the location
         for the lock file, and props/targets from nuget packages. -->
    <BaseIntermediateOutputPath>$(BaseOutputPath)\obj\$(OSPlatformConfig)\Managed\</BaseIntermediateOutputPath>
    <IntermediateOutputPath>$(BaseIntermediateOutputPath)$(BuildProjectRelativeDir)\</IntermediateOutputPath>
    <__NativeTestIntermediatesDir Condition="'$(__NativeTestIntermediatesDir)' == ''">$(BaseOutputPath)\obj\$(OSPlatformConfig)\Native\</__NativeTestIntermediatesDir>

    <OutputPath>$(BaseOutputPathWithConfig)$(BuildProjectRelativeDir)</OutputPath>

    <BasePackagePath>$(IntermediateOutputPath)</BasePackagePath>
    <BasePackagePath Condition="'$(PackageRuntimeIdentifier)' != ''">$([System.IO.Path]::GetFullPath($(IntermediateOutputPath)\$(PackageRuntimeIdentifier)))</BasePackagePath>

    <PackageOutputPath>$(BasePackagePath)</PackageOutputPath>
    <RestoreOutputPath>$(BasePackagePath)</RestoreOutputPath>
    <MSBuildProjectExtensionsPath>$(BasePackagePath)</MSBuildProjectExtensionsPath>

    <ProjectAssetsFile>$(RestoreOutputPath)/project.assets.json</ProjectAssetsFile>
  </PropertyGroup>
  
  <PropertyGroup>
    <DisableImplicitFrameworkReferences Condition="'$(__SkipFXRestore)' == 'true'">true</DisableImplicitFrameworkReferences>
  </PropertyGroup>

  <ItemGroup Condition="'$(__SkipFXRestore)' == 'true' AND '$(ReferenceSystemPrivateCoreLib)' != 'true'" >
    <Reference Include="$(__LocalCoreFXPath)\artifacts\bin\ref\$(NetCoreAppCurrent)\*.dll" Private="false" />
  </ItemGroup>
  
</Project>

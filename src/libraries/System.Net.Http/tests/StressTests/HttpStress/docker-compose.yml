version: '3' # Although the version attribute is obsolete and should be ignored, it's seemingly not the case on Build.Ubuntu.2204.Amd64.Open
services:
  client:
    build:
      context: .
      dockerfile: ${DOCKERFILE:-Dockerfile}
    image: httpstress
    volumes:
      - "${DUMPS_SHARE}:${DUMPS_SHARE_MOUNT_ROOT}"
    links:
      - server
    environment:
      - STRESS_ARGS=-runMode client -serverUri https://server:5001 ${STRESS_CLIENT_ARGS}
      - STRESS_ROLE=client
      - DUMPS_SHARE_MOUNT_ROOT=${DUMPS_SHARE_MOUNT_ROOT}
  server:
    build:
      context: .
      dockerfile: ${DOCKERFILE:-Dockerfile}
    image: httpstress
    volumes:
      - "${DUMPS_SHARE}:${DUMPS_SHARE_MOUNT_ROOT}"
    ports:
      - "5001:5001"
    environment:
      - STRESS_ARGS=-runMode server -serverUri https://+:5001 ${STRESS_SERVER_ARGS}
      - STRESS_ROLE=server
      - DUMPS_SHARE_MOUNT_ROOT=${DUMPS_SHARE_MOUNT_ROOT}

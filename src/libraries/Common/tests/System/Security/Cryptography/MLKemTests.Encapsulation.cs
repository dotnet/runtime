// Licensed to the .NET Foundation under one or more agreements.
// The .NET Foundation licenses this file to you under the MIT license.

using System.Collections.Generic;
using System.Globalization;
using Microsoft.DotNet.XUnitExtensions;
using Xunit;

namespace System.Security.Cryptography.Tests
{
    public static partial class MLKemTests
    {
        #pragma warning disable CS0219
        [Fact]
        public static void MLKem_Scratch()
        {
            const string DK = "FFB93E594AB462B4070F2684B3845649B96474760BED1BAAD22A38B2667B7765C504B03D65EBB1B88B613C978518428097650320821454B971C3107962E00E4A575EADA990B1B945BE845FB9411D9C8303224B7CB1D27E0286213C1AC1052C363ACA3B0C053FAF48577FE4107BF35343FC39F7A5305A98AB2CC315A84C5C60D9940E409D65B63BFB3694FA249556F87BD27C28D00A62A3299FBAC0501A3634A11267584A216F365614563FA327686CA32B38E3102E7305E48A7DE910737E688351E94DA054CF1D17944305678000BDD9CC8B93333660A85AE6B8C4612A6535E5AE8C959125141E6536AE662C741AEA0D783B53962B5CC612750AB3AEA3708445EC97B2BA1EF3589CE9F94D3A4B91E4052A746635A595568640B375E5872E30777137874A429A4741AA81CA63A90884E54527A48B84F274C0E04B92386304D50048D78713BE0A9008A69DD49CB886CB6E7BFC7CA9EA03F09896D739C292C3021B2A985CD858DE5A574A7C431CA3795CDC436EE58596B10A1507B60267B1C735BE22E05F5E6AAA12F132FB932DC815B2411CAC97EB729EBBA95D5C1CD7280A339CBC56E85D00763A1B6A371735CAA1B8A699C431EFD2182366AD4E7B4765E9A842ABAB175128AD4127BA447157F56098B3C14C561502406531FA06863C85A406494CF330E591BF58FC0216B9A66CFC39EC26C10FF97FD50017CEA705363B0BBCC9874BB2BCD0AB08631140923AA88E0AC43531757C689F3F075FEB3B59767BC1A327C1EC8A7E0670415ABAC9D0CC1D7854620E8339B5456E3D5A1AC3562E8F78808611CEEDB57BF0DAA937CC8E2C1780DAEC6FD08ACA72876EE010C290AA6136EA91E71605C6F2BEDF89B9519A5AA353C3E7415F4D4915907461C1A0559CEC7232F7A90A17821C84864739CDA43C7C94A63197DA4EC3E82DE870CCDCE4988DAB713530B8CD889A010A769DFC148CC896C2AA00AE28041B4AC0905373408082992142F61B817152609759807105C2A43C508FBB4748F094DC4A2EB6330A70543B405CC34D1842F6711B41F790E82316F6A44CB99262FC4338455863515AB67FE6898D895727F11672FB1A064C7A1F53AAE3AABC55296A44C3758BACC25866A78F587B6804548EABB93F70A931E0576B3584A075BBEC98C14BE62846E579F01542C5125E29BBC449E4BE2A14BBF879192FFC272B0977876895F610B2E5C4236533240D07CBBE67412E8C7B3A143542F94B73BB776EDB8F079136AF08883E30411A6AB3415340698837C9F6B314A206E2A7906275BA04DC442DE87D00D57C6A35B2CEABB4C0CA9366B6897FF03D2B212169EC7555FCC462C568C9E3346203A9AA5064A2F4ABF97115E5E2C77AD9101D5502554A26E5366FEE2177E33055956224CF522B2FEBCBEF3C4631354077153ED996C9D8D2961153C373D66C3889087D7BCE35378DA5F32EE806A3D525C6A243176BE5856B687299A56331CC4C448AA07C23BD937C0FDB96C118485B17250A9BCC464B8046A57C8D1DAB3DF5D751C8C2B2999A3BD4F134DA7740D4948EF0A796C5EB0BD2D6CE75B853CBA17EA1F2B1DD2025C6752FEFFA324D463F722898821A537B78812F52921622111EE26E69450D5934238A6A5BE752169BEA78348A4C22434EEAB726D9E126BCF8951915428CD18CD771426B3A984E50B4D7F303392607C217120751942C4CBFE07A21862C9B0165565A487DD0E72EFED935EC99360933923AF601C097BB99312EC8F213F5D53D56687E89FA1E3E9219341A62953631551A568115CD56A20E1B088900CC286125AE8B450F8428269D943C2354278B184DC135BF79345A39601D33FB901B97467D950E981644E2C500885A7D9B3243AC3463D755A57F2A659108244A070DE13154F83A06CF4928741568505965E1E06D6501540DC8972FDC951A862C6A35CCED9245D1B2B85933550D96B60FBA9FBAC34888E87B6B335BE41AAA72447FD5D9A64E529CD29A365B6603ECF9736429B02FE46FBAE82EBC8003E127508BA518303382655C51551CBA7F0A48C4E58D1052C6A1648509E308A3F95814D7138DD28ACE9306AA0529A9712BB6827AAFAA6CAB67CAD96CAD4FF4903CA02954D26132551961C0B680000F01DC08CC361BC9FB449D455793CB2659D800016C87A1B98433CA191CC663BDD64304BEBAD0D3333C2036619F936ACE5A0B62805EA5FB49D9AD8106A217913DFA277AD62F7CAEAA930284E348256EDCCA5578A06528678CBAD23F0A8DE1D40BAD0A76BA218C111C0DBB15963741113EACF5407A795D689E6E1EF1DE8B0351";
            const string C = "142317973B20175B067DC6DBC5CFE3DCE9725EA70F43B7E099D40B26396B4D534A7A1CA4115FAA96536C4592ACB7C1E6673225F0D225650D82EB05D2DDDAFBD221CA0820FA5136C207ACC32C4847360E3D681E12965B5179AB1653ABEF192A333B809AE8DE83BABD12F493C5608A46E39D03DCBA10D7F0B1B6F826BE07D64E4C86FDEF6F53FFF66CE91A5F178FDAFDF763911EC53C9A99B024F0A1B7025C3AB9E18C06BBBB4879E6139F779C77D189D9B69835A9BE3407BBB1E7748262E8326366BB7CF04CBF9E685624C598B577DBE020F02979CBE9273D8AFE9BF2F1ECB8C054312616AEA17F7E7EF5A751B93652214276622C1BD22B80BEE5404ACDB6C05136E8B306E97B291BA749278B4A5E6CC5A49A9D233CC3961D5F3A30DA338AB7B2618FD39758E14B3FB04CE44A976AB06A4626F0A879FBC4EECC6933B44411922EC71B9F3C9E7AA68342F7CE2ED692C458454365C05E1192018DD0F7133A05D1A526BCB7EEA261729253D69E49F3290D2C1F0F28F254E7256ABCC64227A54C591BE2AD00B643A9018170DB2CE5DEFF7768FCDAFF327DC7968274EBC97AC94B26B40EA277992E731756D25EA52DD2ACFAA69AC6472A241A638EF03E7333172908E5495C948C101A7A8A1A4AD80FFA51FD4C7328732296341AA0BE2C385C00C831ED61665B425CE6541754D7BFE71651DDDE9ADD016C6D1F1B84E8ABAED1CB1106D3963896CFF8524A294D7B73C5C6A4DF40D03AEFF1F791F43CC2671EC2A80DAD4C47F413A27A8A62386E7A1CC33403A6B286203F734C7C6537F125B7170DF5B4D22EB964317B1AB1209579C505ACEA8D77E90FAC276008E4861A02B60D8F21B9C4F8C25FA0A406DB3855A0992CAD6E1A988BD238810B8703BBC7BEF0857C09BB321914FE64C0759F36B9B0D0B3E4E656DA1DB935D3CD62C9CCF3B60FE02099D28CEEE44E96D06FC166BCE74BC2377E50A45598CB42BDD1FB9B3897DD763E98EA677B3EAD5FE9BA97E778D869CA4854102CD758DEDDB53EFDD85CC5E95D34522EFAD144AFDBEE7598016476B7315DC3254331177EE36B11E82200EC3DED0D4EEF56";
            const string K = "651EFBAECF2DC8AF26E8849DD5A9D4B373D9D1FDB18BE61C4FE1F1CD1C9D5493";

            using MLKem kem = MLKem.ImportMLKemDecapsulationKey(MLKemAlgorithm.MLKem512, Convert.FromHexString(DK));
            byte[] sharedSecret = new byte[MLKem.SharedSecretSizeInBytes];
            kem.Decapsulate(Convert.FromHexString(C), sharedSecret);
            AssertExtensions.SequenceEqual(Convert.FromHexString(K), sharedSecret);
        }
    }
}

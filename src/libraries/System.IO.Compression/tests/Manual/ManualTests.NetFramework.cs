// Licensed to the .NET Foundation under one or more agreements.
// The .NET Foundation licenses this file to you under the MIT license.

using System.IO.Compression;
using System.Linq;
using System.Reflection;
using System.Text;
using Xunit;

namespace System.IO.Compression.Tests;

public class ManualTests
{
    [Fact]
    public static void VerifyZip64FixInNetFramework()
    {
        // This test has the purpose of verifying that .NET Framework can read a zip file generated with the Zip64 fix introduced in .NET.
        // The zip file with the fix needs to be manually generated by the GenerateZip64File test method in ManualTests.Net.cs. 

        string zipArchivePath = Path.Combine(Path.GetTempPath(), "over4GB_WithoutBug.zip");
        Assert.True(File.Exists(zipArchivePath));

        using FileStream fs = File.OpenRead(zipArchivePath);

        // Open archive to verify that we can still read an archive with the buggy version
        using (ZipArchive zip = new ZipArchive(fs, ZipArchiveMode.Read))
        {
            Assert.Equal(1, zip.Entries.Count);
            ZipArchiveEntry entry = zip.Entries.First();
            Assert.Equal("file.txt", entry.Name);
            Assert.Equal(5_000_000_000, entry.Length);
        }
    }
}

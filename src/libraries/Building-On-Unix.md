# Building CoreFx on Ubuntu
## Build Instructions
CoreFx can be built using the cross-platform branch of MSBuild on top of current CI builds of Mono. These instructions have been validated on 15.04 and 12.04.
### Installing Mono
_Mono installation instructions are taken from http://www.mono-project.com/docs/getting-started/install/linux/ and http://www.mono-project.com/docs/getting-started/install/linux/ci-packages/._

Add Mono key and package sources.
```
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
echo "deb http://download.mono-project.com/repo/debian wheezy main" | sudo tee /etc/apt/sources.list.d/mono-xamarin.list
echo "deb http://jenkins.mono-project.com/repo/debian sid main" | sudo tee /etc/apt/sources.list.d/mono-jenkins.list
sudo apt-get update
```
Install a recent Mono build and the PCL reference assemblies. (_This instruction installs latest. To see available Mono builds, use `apt-cache search mono-snapshot`_)
```
sudo apt-get install mono-snapshot-latest referenceassemblies-pcl
```
Switch to the mono snapshot build.
```
. mono-snapshot mono
```
### Building xplat MSBuild
Clone MSBuild, install dependencies, then build. (This step will be replaced by a package dependency soon)
```
git clone https://github.com/microsoft/msbuild.git
git checkout xplat
sudo apt-get install curl perl
perl build.pl
```
### Building CoreFx
Clone CoreFx if you haven't already, and set the following workaround.
```
git clone https://github.com/dotnet/corefx.git
```
Build via script if MSBuild is relative to your corefx enlistment as so `../MSBuild`.
```
./build.sh
```
_OR_ build manually, changing the paths to match where you've cloned MSBuild/CoreFx.
```
export MONO29679=1
export ReferenceAssemblyRoot=/usr/lib/mono/xbuild-frameworks
mono ~/repos/msbuild/bin/Unix/Debug-MONO/MSBuild.exe -t:Build -fl "-flp:LogFile=msbuild-corefx.log;V=diag;" -p:Configuration=Linux_Debug -p:UseRoslynCompiler=true ~/repos/corefx/build.proj
``` 
## Known Issues
PCL reference assemblies and targets are not installed by default. They also are not available for snapshot builds, and must be copied, linked in, or use the ReferenceAssemblyRoot override. The instructions above show the root override, the following is how to link the PCL folder in the right place.
```
sudo ln -s /usr/lib/mono/xbuild-frameworks/.NETPortable/ $MONO_PREFIX/lib/mono/xbuild-frameworks/
```
If you are seeing errors like the following you likely either have not installed the package or haven't linked it properly.
```
warning MSB3252: The currently targeted framework ".NETPortable,Version=v4.5,Profile=Profile7" does not include the referenced assembly
MSB3644: The reference assemblies for framework ".NETPortable,Version=v4.5,Profile=Profile7" were not found.
```
Mono may intermittently fail when compiling. Retry if you see sigfaults or other unexpected issues.

PDBs aren't generated by Roslyn on Unix. https://github.com/dotnet/roslyn/issues/2449

Test runs are currently disabled when building on Unix. https://github.com/dotnet/corefx/issues/1776

System.Diagnostics.FileVersionInfo.Tests.csproj does not build on Unix. https://github.com/dotnet/corefx/issues/1610

System.Diagnostics.Debug.Tests does not build on Unix. https://github.com/dotnet/corefx/issues/1609

Mono fails when trying to get custom attributes on CoreFx assemblies. https://bugzilla.xamarin.com/show_bug.cgi?id=29679
<Project>

  <Import Project="..\Directory.Build.targets" />

  <PropertyGroup>
    <TypeForwardedTypesCompilePath>$(IntermediateOutputPath)$(MSBuildProjectName).TypeForwardedTypes.cs</TypeForwardedTypesCompilePath>
  </PropertyGroup>

  <Target Name="CreateCompileSourceForTypeForwardedTypes"
          BeforeTargets="CoreCompile"
          Inputs="$(MSBuildProjectFullPath)"
          Outputs="$(TypeForwardedTypesCompilePath)">
    <Error Text="The 'TypeForwardedType' item must not be empty." Condition="'@(TypeForwardedType)' == ''" />

    <ItemGroup>
      <TypeForwardedType Namespace="$([System.String]::new('%(Identity)').Substring(0, $([System.String]::new('%(Identity)').LastIndexOf('.'))))" />
      <TypeForwardedType TypeName="$([System.String]::new('%(Identity)').Substring($([MSBuild]::Add($([System.String]::new('%(Identity)').LastIndexOf('.')), 1))))" />
      <TypeForwardedTypesLine Include="namespace %(TypeForwardedType.Namespace) { public class %(TypeForwardedType.TypeName) { } }" />
    </ItemGroup>

    <WriteLinesToFile File="$(TypeForwardedTypesCompilePath)"
                      Lines="@(TypeForwardedTypesLine)"
                      Overwrite="true" />
    
    <ItemGroup>
      <Compile Include="$(TypeForwardedTypesCompilePath)" />
      <FileWrites Include="$(TypeForwardedTypesCompilePath)" />
    </ItemGroup>
  </Target>
</Project> 

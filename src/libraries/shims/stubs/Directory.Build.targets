<Project>

  <Import Project="..\..\Directory.Build.targets" />

  <PropertyGroup>
    <ForwardedTypesCompilePath>$(IntermediateOutputPath)$(MSBuildProjectName).ForwardedTypes.cs</ForwardedTypesCompilePath>
  </PropertyGroup>

  <Target Name="CreateCompileSourceForForwardedTypes"
          BeforeTargets="CoreCompile"
          Inputs="$(MSBuildProjectFullPath)"
          Outputs="$(ForwardedTypesCompilePath)">
    <Error Text="The 'ForwardedType' item must not be empty." Condition="'@(ForwardedType)' == ''" />

    <ItemGroup>
      <ForwardedType Namespace="$([System.String]::new('%(Identity)').Substring(0, $([System.String]::new('%(Identity)').LastIndexOf('.'))))" />
      <ForwardedType TypeName="$([System.String]::new('%(Identity)').Substring($([MSBuild]::Add($([System.String]::new('%(Identity)').LastIndexOf('.')), 1))))" />
      <ForwardedTypesLine Include="namespace %(ForwardedType.Namespace) { public static class %(ForwardedType.TypeName) { } }" />
    </ItemGroup>

    <WriteLinesToFile File="$(ForwardedTypesCompilePath)"
                      Lines="@(ForwardedTypesLine)"
                      Overwrite="true" />

    <ItemGroup>
      <Compile Include="$(ForwardedTypesCompilePath)" />
      <FileWrites Include="$(ForwardedTypesCompilePath)" />
    </ItemGroup>
  </Target>
</Project> 

<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>$(NetCoreAppCurrent)-windows;$(NetCoreAppCurrent)-OSX;$(NetCoreAppCurrent)-Linux;$(NetCoreAppCurrent);$(NetCoreAppMinimum)-windows;$(NetCoreAppMinimum)-OSX;$(NetCoreAppMinimum)-Linux;$(NetCoreAppMinimum);netstandard2.0</TargetFrameworks>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <IncludeDllSafeSearchPathAttribute>true</IncludeDllSafeSearchPathAttribute>
    <Nullable>annotations</Nullable>
    <!-- CS3016: Arrays as attribute arguments is not CLS-compliant -->
    <NoWarn>$(NoWarn);CS3016</NoWarn>
    <IsPackable>true</IsPackable>
    <AddNETFrameworkPlaceholderFileToPackage>true</AddNETFrameworkPlaceholderFileToPackage>
    <AddNETFrameworkAssemblyReferenceToPackage>true</AddNETFrameworkAssemblyReferenceToPackage>
    <PackageDescription>Provides the methods defined in the Lightweight Directory Access Protocol (LDAP) version 3 (V3) and Directory Services Markup Language (DSML) version 2.0 (V2) standards.</PackageDescription>
  </PropertyGroup>

  <!-- DesignTimeBuild requires all the TargetFramework Derived Properties to not be present in the first property group. -->
  <PropertyGroup>
    <TargetPlatformIdentifier>$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)'))</TargetPlatformIdentifier>
    <GeneratePlatformNotSupportedAssemblyMessage Condition="'$(TargetPlatformIdentifier)' == ''">SR.DirectoryServicesProtocols_PlatformNotSupported</GeneratePlatformNotSupportedAssemblyMessage>
    <EnableDefaultCompileItems Condition="'$(TargetPlatformIdentifier)' == ''">false</EnableDefaultCompileItems>
    <DefaultItemExcludesInProjectFolder Condition="'$(TargetPlatformIdentifier)' == 'windows'">**\*.Linux.cs</DefaultItemExcludesInProjectFolder>
    <DefaultItemExcludesInProjectFolder Condition="'$(TargetPlatformIdentifier)' != 'windows'">**\*.Windows.cs</DefaultItemExcludesInProjectFolder>
  </PropertyGroup>

  <ItemGroup Condition="'$(TargetPlatformIdentifier)' != ''">
    <Compile Include="$(CommonPath)Interop\Interop.Ldap.cs" Link="Common\Interop\Interop.Ldap.cs" />
    <Compile Include="$(CommonPath)Interop\Windows\Interop.BOOL.cs" Link="Common\Interop\Windows\Interop.BOOL.cs" />
    <Compile Include="$(CommonPath)DisableRuntimeMarshalling.cs"
             Link="Common\DisableRuntimeMarshalling.cs"
             Condition="$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net7.0'))" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetPlatformIdentifier)' == 'windows'">
    <Compile Remove="System\DirectoryServices\Protocols\ldap\LocalAppContextSwitches.cs" />    

    <Compile Include="$(CommonPath)Interop\Windows\Interop.Libraries.cs"
             Link="Common\Interop\Windows\Interop.Libraries.cs" />
    <Compile Include="$(CommonPath)Interop\Windows\Wldap32\Interop.Ldap.cs"
             Link="Common\Interop\Windows\Wldap32\Interop.Ldap.cs" />
    <Compile Include="$(CommonPath)Interop\Windows\Wldap32\Interop.Ber.cs"
             Link="Common\Interop\Windows\Wldap32\Interop.Ber.cs" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetPlatformIdentifier)' == 'Linux' or '$(TargetPlatformIdentifier)' == 'OSX'">
    <Compile Include="$(CommonPath)System\LocalAppContextSwitches.Common.cs"
             Link="Common\System\LocalAppContextSwitches.Common.cs" />
    <Compile Include="$(CommonPath)Interop\Linux\OpenLdap\Interop.Ldap.cs"
             Link="Common\Interop\Linux\OpenLdap\Interop.Ldap.cs" />
    <Compile Include="$(CommonPath)Interop\Linux\OpenLdap\Interop.Ber.cs"
             Link="Common\Interop\Linux\OpenLdap\Interop.Ber.cs" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetPlatformIdentifier)' == 'Linux'">
    <Compile Include="$(CommonPath)Interop\Linux\Interop.Libraries.cs"
             Link="Common\Interop\Linux\Interop.Libraries.cs" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetPlatformIdentifier)' == 'OSX'">
    <Compile Include="$(CommonPath)Interop\OSX\Interop.Libraries.cs"
             Link="Common\Interop\OSX\Interop.Libraries.cs" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' == '.NETStandard'">
    <PackageReference Include="System.Security.Principal.Windows" Version="$(SystemSecurityPrincipalWindowsVersion)" />
  </ItemGroup>
</Project>

<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFrameworks>$(NetCoreAppCurrent);$(NetCoreAppPrevious);$(NetCoreAppMinimum);netstandard2.0;$(NetFrameworkMinimum)</TargetFrameworks>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <DefineConstants>$(DefineConstants);RESOURCES_EXTENSIONS</DefineConstants>
    <EnableAOTAnalyzer>false</EnableAOTAnalyzer>
    <IncludeInternalObsoleteAttribute>true</IncludeInternalObsoleteAttribute>
    <UseCompilerGeneratedDocXmlFile>false</UseCompilerGeneratedDocXmlFile>
    <IsPackable>true</IsPackable>
    <SuggestedBindingRedirectsPackageFile>$(BaseIntermediateOutputPath)SuggestedBindingRedirects.targets</SuggestedBindingRedirectsPackageFile>
    <BeforePack>$(BeforePack);GeneratePackageTargetsFile</BeforePack>
    <PackageDescription>Provides classes which read and write resources in a format that supports non-primitive objects.

Commonly Used Types:
System.Resources.Extensions.DeserializingResourceReader
System.Resources.Extensions.PreserializedResourceWriter</PackageDescription>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="$(CommonPath)System\Obsoletions.cs"
             Link="Common\System\Obsoletions.cs" />
    <Compile Include="$(CommonPath)System\Resources\ResourceWriter.cs"
             Link="System\Resources\Extensions\ResourceWriter.cs" />
    <Compile Include="$(CoreLibSharedDir)System\IO\PinnedBufferMemoryStream.cs"
             Link="System\IO\PinnedBufferMemoryStream.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Resources\FastResourceComparer.cs"
             Link="System\Resources\FastResourceComparer.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Resources\ResourceReader.cs"
             Link="System\Resources\Extensions\ResourceReader.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Resources\ResourceTypeCode.cs"
             Link="System\Resources\ResourceTypeCode.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Resources\RuntimeResourceSet.cs"
             Link="System\Resources\Extensions\RuntimeResourceSet.cs" />
    <Compile Include="BinaryReaderExtensions.cs" />
    <Compile Include="BinaryWriterExtensions.cs" />
    <Compile Include="System\Resources\Extensions\DeserializingResourceReader.cs" />
    <Compile Include="System\Resources\Extensions\PreserializedResourceWriter.cs" />
    <Compile Include="System\Resources\Extensions\SerializationFormat.cs" />
    <Compile Include="System\Resources\Extensions\TypeNameComparer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\BinaryFormattedObject.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\BinaryFormattedObject.IParseState.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\BinaryFormattedObject.ITypeResolver.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\BinaryFormattedObject.Options.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\BinaryFormattedObject.ParseState.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\BinaryFormattedObject.TypeResolver.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\BinaryFormattedObjectExtensions.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Id.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\SerializationEvents.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\SerializationExtensions.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\SerializationInfoExtensions.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\ArrayRecordDeserializer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\ArrayUpdater.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\ClassRecordDeserializer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\ClassRecordFieldInfoDeserializer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\ClassRecordSerializationInfoDeserializer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\Deserializer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\FieldValueUpdater.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\IDeserializer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\ObjectRecordDeserializer.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\PendingSerializationInfo.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\SerializationInfoValueUpdater.cs" />
    <Compile Include="System\Resources\Extensions\BinaryFormat\Deserializer\ValueUpdater.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Numerics\Hashing\HashHelpers.cs"
             Link="System\Numerics\Hashing\HashHelpers.cs" />
  </ItemGroup>

  <!-- when System.Runtime.Serialization.BinaryFormat gets approved, this whole block will be repalced with a reference to package -->
  <ItemGroup>
    <Compile Include="$(LibrariesProjectRoot)\System.Runtime.Serialization.BinaryFormat\src\**\*.cs" />
    <ProjectReference Include="$(LibrariesProjectRoot)\System.IO.Hashing\src\System.IO.Hashing.csproj" />
    <ProjectReference Include="$(LibrariesProjectRoot)\System.Reflection.Metadata\src\System.Reflection.Metadata.csproj" />
    <PackageReference Include="System.ValueTuple" Version="$(SystemValueTupleVersion)" Condition="'$(TargetFrameworkIdentifier)' == '.NETFramework'" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' != '.NETCoreApp'">
    <Compile Include="$(CoreLibSharedDir)System\Diagnostics\CodeAnalysis\RequiresUnreferencedCodeAttribute.cs" 
             Link="System\Diagnostics\CodeAnalysis\RequiresUnreferencedCodeAttribute.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Diagnostics\CodeAnalysis\UnconditionalSuppressMessageAttribute.cs"
             Link="System\Diagnostics\CodeAnalysis\UnconditionalSuppressMessageAttribute.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Diagnostics\CodeAnalysis\DynamicDependencyAttribute.cs"
             Link="System\Diagnostics\CodeAnalysis\DynamicDependencyAttribute.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Diagnostics\CodeAnalysis\DynamicallyAccessedMembersAttribute.cs"
             Link="System\Diagnostics\CodeAnalysis\DynamicallyAccessedMembersAttribute.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Diagnostics\CodeAnalysis\DynamicallyAccessedMemberTypes.cs"
             Link="System\Diagnostics\CodeAnalysis\DynamicallyAccessedMemberTypes.cs" />
    <Compile Include="$(CoreLibSharedDir)System\Diagnostics\CodeAnalysis\RequiresDynamicCodeAttribute.cs"
             Link="System\Diagnostics\CodeAnalysis\RequiresDynamicCodeAttribute.cs" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' != '.NETCoreApp'">
    <PackageReference Include="System.Memory" Version="$(SystemMemoryVersion)" />
  </ItemGroup>

  <Target Name="GeneratePackageTargetsFile" 
          Inputs="$(MSBuildAllProjects)"
          Outputs="$(SuggestedBindingRedirectsPackageFile)"
          Condition="'$(NetFrameworkMinimum)' != ''">
    <PropertyGroup>
      <SuggestedBindingRedirectsPackageFileContent><![CDATA[<Project>
  <!-- ResolveAssemblyReferences will never see the assembly reference embedded in the resources type,
       force a binding redirect ourselves so that we'll always unify to the System.Resources.Extensions
       version provided by this package -->
  <ItemGroup>
    <SuggestedBindingRedirects Include="$(AssemblyName), Culture=neutral, PublicKeyToken=$(PublicKeyToken)" MaxVersion="$(AssemblyVersion)" />
  </ItemGroup>
</Project>
]]></SuggestedBindingRedirectsPackageFileContent>
    </PropertyGroup>

    <WriteLinesToFile File="$(SuggestedBindingRedirectsPackageFile)"
                      Lines="$(SuggestedBindingRedirectsPackageFileContent)"
                      Overwrite="true" />

    <ItemGroup>
      <Content Include="$(SuggestedBindingRedirectsPackageFile)"
               PackagePath="buildTransitive\$(NetFrameworkMinimum)\$(PackageId).targets" />
    </ItemGroup>
  </Target>

</Project>

<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>$(NetCoreAppToolCurrent)</TargetFramework>
    <Description>Example managed library that will be included in a NativeAOT compiled binary</Description>
    <EnableDefaultItems>true</EnableDefaultItems>
    <Nullable>enable</Nullable>
    <IncludeSymbols>true</IncludeSymbols>
    <Serviceable>true</Serviceable>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <IsShipping>true</IsShipping>
    <!-- this assembly should not produce a public package, rather it's meant to be shipped by the
          WasmAppBuilder task and the BrowserDebugProxy -->
    <IsShippingPackage>false</IsShippingPackage>
  </PropertyGroup>

  <PropertyGroup>
      <PublishAot>true</PublishAot>
      <SelfContained>true</SelfContained>
  </PropertyGroup>

  <PropertyGroup>
    <!-- in net9.0 we can do this -->
    <SharedLibraryInstallName>@rpath/$(MSBuildProjectName).dylib</SharedLibraryInstallName>
  </PropertyGroup>

  <PropertyGroup>
      <!-- our CI doesn't have bfd? -->
      <LinkerFlavor Condition="'$(LinkerFlavor)' == '' and '$(TargetsLinux)' == 'true'">lld</LinkerFlavor>
  </PropertyGroup>


  <!-- TODO: emit a cmake fragment that includes the location of the ilcompiler nuget's sdk and framework files. -->

  <ItemGroup>
      <ProjectReference Include="..\..\..\tools\Microsoft.DotNet.HelloManaged\src\Microsoft.DotNet.HelloManaged.csproj" />
  </ItemGroup>

  <!-- TODO: remove -->
  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' == '.NETFramework'">
    <Compile Include="$(CoreLibSharedDir)System\Diagnostics\CodeAnalysis\NullableAttributes.cs" Link="System\Diagnostics\CodeAnalysis\NullableAttributes.cs" />
    <Compile Include="..\..\..\tasks\Common\IsExternalInit.cs" />
  </ItemGroup>

  <Import Project="..\write-nativelib-cmake.targets" />

</Project>

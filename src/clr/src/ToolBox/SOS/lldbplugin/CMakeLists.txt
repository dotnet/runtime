project(sosplugin)

set(CMAKE_INCLUDE_CURRENT_DIR ON)

if((NOT $ENV{LLDB_INCLUDE_DIR} STREQUAL "") AND (NOT $ENV{LLDB_LIB_DIR} STREQUAL ""))
    # The OSx build depends on the environment variables LLDB_INCLUDE_DIR and LLDB_LIB_DIR being set
    set(LLDB_INCLUDE_DIR "$ENV{LLDB_INCLUDE_DIR}")
    set(LLDB_LIB_DIR "$ENV{LLDB_LIB_DIR}")
else()
    # The Linux build depends on the lldb-3.5-dev package
    set(LLVM_DIR "/usr/lib/llvm-3.5")
    set(LLDB_INCLUDE_DIR "${LLVM_DIR}/include")
    set(LLDB_LIB_DIR "${LLVM_DIR}/lib")
endif()

message(LLDB_INCLUDE_DIR=${LLDB_INCLUDE_DIR})
message(LLDB_LIB_DIR=${LLDB_LIB_DIR})

add_compile_options(-Wno-delete-non-virtual-dtor)

include_directories(inc)
include_directories("${LLDB_INCLUDE_DIR}")
link_directories("${LLDB_LIB_DIR}")

set(SOURCES
    sosplugin.cpp
    soscommand.cpp
    debugclient.cpp
)

add_library(sosplugin SHARED ${SOURCES})
add_dependencies(sosplugin sos)

# add the install targets
install (TARGETS sosplugin DESTINATION .)